# Podkop с поддержкой устаревших версий OpenWRT (iptables)

По функционалу полностью идентичен оригинальному Podkop. Работоспособность (основного функционала) проверена на OpenWRT 21 (GL.iNet GL-MT6000 Flint 2) и на более свежих версиях (BPI R4 на OpenWRT 24). Некоторые зависимости, связанные с ядром, ставятся отдельно, поэтому внимательно читаем и не забываем проверить их наличие. Либо пользуемся скриптом автоматической установки.

# Вещи, которые вам нужно знать перед установкой

- Это бета-версия, которая находится в активной разработке. Из версии в версию что-то может меняться.
- При возникновении проблем, нужен технически грамотный фидбэк в чат.
- При обновлении **обязательно** [сбрасывайте кэш LuCI](https://podkop.net/docs/clear-browser-cache/).
- Также при обновлении всегда заходите в конфигурацию и проверяйте свои настройки. Конфигурация может измениться.
- Необходимо минимум 15МБ свободного места на роутере. Роутеры с флешками на 16МБ сразу мимо.
- При старте программы редактируется конфиг Dnsmasq.
- Podkop редактирует конфиг sing-box. Обязательно сохраните ваш конфиг sing-box перед установкой, если он вам нужен.
- [Если у вас что-то не работает.](https://podkop.net/docs/diagnostics/)
- Если у вас установлен Getdomains, [его следует удалить](https://github.com/itdoginfo/domain-routing-openwrt?tab=readme-ov-file#%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82-%D0%B4%D0%BB%D1%8F-%D1%83%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F).

# Документация
https://podkop.net/

# Автоматическая установка
Заходим на роутер через ssh, скачиваем и запускаем установочный скрипт одной командой:
```
wget -O - https://raw.githubusercontent.com/wwwean/podkop-backport/refs/heads/test/install.sh > install.sh && chmod +x install.sh && ./install.sh
```

# Ручная установка
## 1. Установка Sing-box (требуется версия не ниже 1.12.4)
Если через Luci или ssh установить не получается (на старых версиях OpenWRT это нормально), то качаем пакет из релиза и устанавливаем.\
Для нормальной работы также нужны следующие пакеты: kmod-inet-diag, kmod-tun. Можно предварительно поставить через Luci или ssh, либо собрать прошивку с этими пакетами. На GL.iNet GL-MT6000 Flint 2 зависимости сами подтянутся из репозитория GL.iNet.

## 2. Установка Podkop-backport
### Предварительно нужно проверить наличие следующих пакетов:
a. Для версии OpenWRT до 21 включительно: kmod-ipt-tproxy. Для GL.iNet GL-MT6000 Flint 2 есть в репозитории производителя, поэтому ставим через Luci или через ssh\
b. Для версии OpenWRT 22 и новее: kmod-nft-tproxy

## 3. Установка Luci App Podkop
Качаем и устанавливаем пакет из релиза через через Luci или через ssh\

